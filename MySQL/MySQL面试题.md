# MySQL面试题

## 事务

+ 事务的隔离性由MySQL中的锁来实现。

+ 事务的原子性、一致性、持久性通过数据库的redo log、undo log来实现。

## MySQL日志

### 常见的日志有哪些？

+ 错误日志
  
  错误日志文件对MySQL的启动、运行、关闭进行了记录，可以通过SHOW VARIABLES LIKE ’log_error‘来定位。

+ 二进制日志
  
  二进制日志记录了对MySQL数据库执行更改的所有操作，不包括SELECT和SHOW等只进行展示的操作。

+ 慢查询日志
  
  可以帮助DBA定位可能存在问题的SQL语句，从而进行SQL语句层面的优化。**long_query_time**默认值为10秒。
  
  通过SHOW VARIABLES LIKE 'long_query_time'定位。
  
  还有一个相关参数是**long_queries_not_using_indexes**，如果没有使用索引就会将这条SQL语句记录到慢查询日志文件。

+ 查询日志
  
  查询日志记录了所有对MYSQL数据库请求的信息，无论这些请求是否得到了正确的执行。默认文件名为：**主机.log**。

### 二进制日志

二进制日志的作用：

1. 恢复，某些数据的恢复需要二进制日志。

2. 复制，使远程数据库与本地数据库实时同步。

3. 审计，判断是否有对数据库进行注入的攻击。

在事务过程中，所有未提交的二进制日志会被记录到缓存中，等事务提交时写入二进制日志文件。

## MySQL事务

### MySQL中redo log是什么？

redo log被称为重做日志，用来保证事务的原子性和持久性。

重做日志用来实现事务的持久性，由两部分组成：一是内存中的重做日志缓冲，二是重做日志文件。

在innoDB中，事务提交时必须先将该事务的所有日志写入重做日志文件进行持久化，待事务的COMMIT操作完成才算完成。

**redolog与binlog的区别**

1. redo log是在InnoDB存储引擎层实现的，binlog是在MySQL数据库上层实现的，binlog可以针对任何存储引擎。

2. binlog是一种逻辑日志，记录的是sql语句。redolog是物理格式日志，记录的是每个页的修改。

3. binlog在事务提交后一次写入，redolog在事务进行中不断写入。

### MySQL中undo log是什么？

事务有时需要进行回滚操作，需要利用undo信息将数据回滚到修改之前的样子。

undolog记录的是与前相反的工作，对于每一个INSERT，undolog会记录一个DELETE；对于每一个DELETE，undolog会记录一个INSERT；对于每个UPDATE，undolog会记录一个相反的UPDATE。

除了回滚操作，undolog的另一个作用是MVCC，当用户读取一行记录时如果该记录已经被其它事务占用，当前事务可以通过undo读取之前的行版本信息，实现非锁定读取。

### 事务的隔离级别

+ 读未提交，允许读取尚未提交的数据变更。

+ 读已提交，允许读取并发事务已经提交的数据。

+ 可重复读，对同一字段多次读取结果是一致的。

+ 串行化

## MySQL锁

### MySQL中锁的类型有哪些？

+ 共享锁，允许事务读一行数据。

+ 排他锁，允许事务删除或更新一行数据。

如果一个事务T1已经获得了行r的共享锁，那么另外的事务T2可以立即获得行r的共享锁。如果有其它的事务T3想获得行r的排他锁，则必须等待事务T1、T2释放行r上的共享锁。

**意向锁**。意向锁为表级别的锁。如果第二个任务视图在表级别上应用共享或排他锁，在锁定该表之前不必检查各个行锁，而只需检查表上的意向锁。

### 锁有可能带来哪些问题？

1. **脏读**
   
   脏数据是指事务对缓冲池中行记录的修改，并且还没有被提交。
   
   脏读指的是在不同的事务下，当前事务可以读到另外事务未提交的数据。

2. **不可重复读**
   
   不可重复读是指在一个事务内多次读取到同一数据集合。在这个事务还没有结束时，另外一个事务也访问同一个数据集合，并做了一些DML操作。在第一个事务两次读数据之间，由于第二个事务的修改，第一个事务两次读到的数据可能是不一样的。

3. **丢失更新**
   
   一个事务的更新操作被另一个事务的更新操作覆盖，从而导致数据的不一致。

## MySQL索引

## 数据库范式

**第一范式**

属性不能再被分割，这个字段只能是一个值，不能再被分为多个字段。**1NF是关系型数据库的基本要求**。

**第二范式**

2NF在1NF的基础上消除了非主属性对于码的部分函数依赖。
