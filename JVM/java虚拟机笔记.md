# java虚拟机笔记

### Java内存区域

## 垃圾回收机制

## 类加载机制

### 什么是类加载机制？

Java虚拟把描述类的数据从Class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这个过程被称作虚拟机的**类加载机制**。

### 类加载的过程是怎样的

一个类型从被加载到虚拟机内存开始，到卸载出内存为止，整个生命周期会经历加载、验证、准备、解析、初始化、使用和卸载七个阶段。

1. **加载**。首先，通过一个类的全限定名来获取定义此类的二进制字节流。
   
   然后，将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。
   
   最后，在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类各种数据的入口。

2. 

### 类加载器规则

类加载阶段中”通过一个类的全限定名获取该类的二进制字节流“是在Java虚拟机外部实现的，以便让应用程序自己决定如何去获取所需的类。实现这个的类被称作**类加载器**。

在Java虚拟机的角度，只存在两种类加载器：一种是**启动类加载器**，另一种是其他所有的类加载器。

- **启动类加载器**：启动类加载器无法被Java程序直接引用。

- **扩展类加载器**：负责加载`<JAVA_HOME>\lib\ext`目录中所有的类库，以扩展JavaSE的功能。

- **应用程序类加载器**：它负责加载`ClassPath`上所有的类库。

### 双亲委派模型

**双亲委派模型**要求除了顶层的启动类加载器外，其余的类加载器都应有自己的父加载器，类加载器的父子关系不是以继承的关系来实现，而通常是使用组合关系来引用父加载器。

**双亲委派模型**的工作过程是：如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把请求委派给父类加载器去完成。

这样做的好处是Java中的类随着它的类加载器一起具备了一种带有优先级的层次关系。如果由各个类自行加载，系统中会出现多个不同的Object类。

### 打破双亲委派模型

在自定义类加载器中，可以对`loadClass()`方法进行重写，子类加载器可以在委派给父类加载器前，先自己尝试加载这个类。
