# 高性能面试题

## 什么是CDN?

CDN全称是内容分发网络。

CDN将静态资源分发到多个不同的地方以实现就近访问，进而加快静态资源的访问速度，减轻服务器以及带宽的负担。

### CDN工作原理是什么？

1. 静态资源如何被缓存到CDN节点中？
   
   可以通过预热的方法将源站的资源同步到CDN的节点中，如果不预热的话，访问的资源可能不在CDN节点中，CDN节点将从源站获取资源。

2. 如何找到最合适的CDN节点？
   
   CDN会通过GSLB找到最合适的CDN节点，具体来说：
   
   1. 浏览器向DNS服务器发送域名请求。
   
   2. DNS服务器根据CNAME别名记录向GSLB发送请求。
   
   3. GSLB返回性能最好的CDN节点地址给浏览器。
   
   4. 浏览器直接访问指定的CDN节点。

3. 如何防止资源被盗刷？
   
   **Referer**防盗链，具体来说就是根据http请求的头信息里面的Referer字段对请求进行限制。

## 读写分离&分库分表

读写分离主要是为了将数据库的读和写操作分到不同的数据库节点上。主服务器负责写、从服务器负责读。

读写分离可以大幅提高读性能，小幅提高写性能。

**主从复制原理是什么?**

MySQL binlog主要记录了MySQL数据库中数据的所有变化。因此能够根据binlog将主库的数据同步到从库中。

**如何避免主从延迟？**

如果业务场景无法容忍主从同步延迟，可以：

1. 强制将读请求路由到主库处理。

2. 延迟读取，没有高可用性。

## 负载均衡

**负载均衡**指的是将用户请求分摊到不同的服务器上处理，以提高系统整体并发处理能力以及可靠性。

### 负载均衡分为哪几种?

负载均衡可以简单分为**服务端负载均衡**和**客户端负载均衡**这两种。

### 服务端负载均衡

**服务端负载均衡**主要应用在**系统外部请求**和**网关层**之间。

+ **四层负载均衡**工作在OSI模型第四层，也就是传输层，这一层的主要协议是TCP/UDP，在这一层可以看到源端口地址以及目标端口地址，通过一定的负载均衡算法将数据包转发到后端真实服务器。四层负载均衡的核心是IP+端口层面的负载均衡。

+ **七层负载均衡**工作在第七层，相比于四层负载均衡更复杂，它会读取报文的数据部分，然后根据读取到的数据内容做出负载均衡决策。

### 负载均衡常见算法有哪些？

+ **随机法**。

+ **轮询法**。轮询法是挨个轮询服务器处理，也可以设置权重。

+ **两次随机法**。多选出一个服务器，然后根据两台服务器的负载情况，从中选出一个最合适的服务器。

+ **哈希法**。将请求参数通过哈希函数转换为一个哈希值，然后根据哈希值来决定请求被哪一台服务器处理。

+ **最小连接法**。遍历服务器节点列表并选取连接数最小的一台服务器响应请求。

+ **最少活跃法**。最少活跃法以活动连接数为标准。

+ **最快响应法**。

### 七层负载均衡可以怎么做？

**DNS解析**

在DNS服务器中为同一个主机记录配置多个IP地址，这些IP地址对应不同的服务器，当用户请求域名时DNS服务器采用轮询算法返回IP地址。

**反向代理**

客户端将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器，获取数据后再返回给客户端。

Nginx就是最常用的反向代理服务器

### 客户端负载均衡通常是怎么做的？

**客户端负载均衡**主要应用于系统内部不同的服务之间，可以使用线程的负载均衡组件实现。

在客户端负载均衡中，客户端会自己维护一份服务器的地址列表，发送之前，客户端根据负载均衡算法来选择具体某一台服务器处理请求。

Ribbon支持的7种负载均衡策略：

+ `RandomRule`：随机策略。

+ `RoundRobinRule`：轮询策略。

+ `WeightedResponseTimeRule`：根据响应时间的权重。

+ `BestAvailableRule`：最小连接数策略。

+ `RetryRule`：重试策略。

+ `AvailabilityFilteringRule`：可用敏感性策略。

+ `ZoneAvoidanceRule`：区域敏感性策略。
